using System.Collections.Generic;
using System.Management;
using System.Reflection;

namespace SysTool.Extensions {
    public static class PutOptionsExtensions {
        public static void UseDefaultUpdateOptions(this PutOptions putOptions, string[] updatedProperties) {
            putOptions.Context = NewPutOptionsContext(updatedProperties);
            putOptions.UseAmendedQualifiers = false;
            putOptions.Type = PutType.UpdateOnly;
        }

        public static void UseDefaultUpdateOptions(this PutOptions putOptions, IEnumerable<PropertyInfo> updatedProperties) {
            var properties = updatedProperties.SelectArray(p => p.Name);
            UseDefaultUpdateOptions(putOptions, properties);
        }

        private static ManagementNamedValueCollection NewPutOptionsContext(string[] updatedProperties) {
            var context = new ManagementNamedValueCollection();
            context.Add("__PUT_EXT_PROPERTIES", updatedProperties);
            context.Add("__PUT_EXTENSIONS", true);
            context.Add("__PUT_EXT_CLIENT_REQUEST", true);
            return context;
        }
    }
}
